<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso | Grupo Distelsa</title>
    <style>
        :root { --primary: #0056b3; --dark: #002d5e; --error: #d9534f; }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            margin: 0; height: 100vh; display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            width: 100%; max-width: 350px; text-align: center;
        }
        .logo { font-size: 28px; font-weight: 800; color: var(--primary); margin-bottom: 5px; }
        .tagline { color: #666; font-size: 14px; margin-bottom: 30px; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; }
        input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;
            transition: border 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; }
        button {
            width: 100%; padding: 12px; background: var(--primary);
            color: white; border: none; border-radius: 6px;
            font-weight: bold; cursor: pointer; font-size: 16px;
        }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #msg { color: var(--error); font-size: 13px; margin-top: 15px; display: none; background: #fdf2f2; padding: 8px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="login-box">
    <div class="logo">Grupo Distelsa</div>
    <div class="tagline">Gestión de Envío de Visa Links</div>
    
    <form id="formLogin">
        <input type="text" id="user" placeholder="Usuario" required>
        <input type="password" id="pass" placeholder="Contraseña" required>
        <button type="submit" id="btn">INGRESAR</button>
    </form>
    
    <div id="msg"></div>
</div>

<script>
    // PEGA AQUÍ TU URL DE GOOGLE APPS SCRIPT
    const API_URL = 'https://script.google.com/macros/s/AKfycbwJ_HUgwt_yTFuXaoEFB6eOue-AH58XJq9ClxYyMyTzrYvUgv9mhWTv2XZYJqzPmwY12g/exec';

    document.getElementById('formLogin').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btn');
        const msg = document.getElementById('msg');
        
        btn.disabled = true;
        btn.innerText = 'Verificando...';
        msg.style.display = 'none';

        const payload = {
            usuario: document.getElementById('user').value,
            password: document.getElementById('pass').value
        };

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
            const result = await res.json();

            if (result.status === 'success') {
                // GUARDAR DATOS DE SESIÓN Y TOKEN
                localStorage.setItem('distelsa_user', result.data.usuario);
                localStorage.setItem('distelsa_token', result.data.token);
                localStorage.setItem('distelsa_rol', result.data.rol);
                
                // Redirección por rol: admin.html, lider.html, agente.html
                window.location.href = result.data.rol.toLowerCase() + '.html';
            } else {
                msg.innerText = result.message;
                msg.style.display = 'block';
                btn.disabled = false;
                btn.innerText = 'INGRESAR';
            }
        } catch (error) {
            msg.innerText = 'Error de conexión con el servidor';
            msg.style.display = 'block';
            btn.disabled = false;
            btn.innerText = 'INGRESAR';
        }
    });
</script>
</body>
</html>
